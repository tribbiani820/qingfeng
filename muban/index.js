var Index=function(){var t={showFlag:1,floatNav:$(".float-nav"),djItem:$(".dj .comic-item")};return t.init=function(){t.initBanner(),t.initChange(),t.initFloatNav(),t.bindDownloadAppEvent(),mkz.isOpenApp()&&mkz.openApp("mkzhan://center")},t.initBanner=function(){new Swiper(".banner",{autoplay:5e3,pagination:".swiper-pagination"})},t.initChange=function(){$(".change").click(function(){var e=t.djItem.length;if(e/6===t.showFlag)t.showFlag=0;else if(e<6)return!1;t.djItem.each(function(e,i){e>=6*t.showFlag&&e<6*(t.showFlag+1)?$(i).show():$(i).hide()}),t.showFlag+=1})},t.initFloatNav=function(){$(window).scroll(function(e){$(this).scrollTop()>300?t.floatNav.fadeIn():t.floatNav.fadeOut()})},t.bindDownloadAppEvent=function(){$(".j-app-downloader").click(function(){mkz.openApp("mkzhan://center")}),$(".float-download-close").click(function(){return $(".j-app-downloader").addClass("hide"),$(".banner-search").addClass("top"),!1})},t},Catagory=function(){var t={underline:$(".catalog-nav .underline"),navItem:$(".catalog-nav .nav-item")};return t.init=function(){t.bindEvent()},t.initSwiper=function(){return new Swiper("#catagoryCon",{watchSlidesVisibility:!0,onSlideChangeStart:function(e){switch(e.activeIndex){case 0:t.underline.animate({left:"10%"},300),t.navItem.eq(0).addClass("active").siblings().removeClass("active");break;case 1:t.underline.animate({left:"35%"},300),t.navItem.eq(1).addClass("active").siblings().removeClass("active");break;case 2:t.underline.animate({left:"60%"},300),t.navItem.eq(2).addClass("active").siblings().removeClass("active");break;case 3:t.underline.animate({left:"85%"},300),t.navItem.eq(3).addClass("active").siblings().removeClass("active")}}})},t.bindEvent=function(){var e=this.initSwiper();t.navItem.click(function(){var t=$(this).index();e.slideTo(t)})},t},Top=function(){var t={pn:1,ps:20,index:21,topType:$(".main").data("name"),type:$(".main").data("type"),moreBtn:$(".getmore"),swicher:$(".rank-nav-item"),container:$(".rank-list")};return t.init=function(){t.detectLoading(),t.bindMore()},t.renderList=function(e){t.loading();var i=t.ps,n=$.Deferred(),a=t.type,c=t.topType;return mkz.mkzAjax({url:"//comic.mkzcdn.com/top/"+c+"/",type:"GET",data:{page_num:e,page_size:i,type:a}}).then(function(e){var i=e.data.list,n="";0==i.length?t.lock():t.unlock();for(var a=0;a<i.length;a++)n='<div class="rank-item clearfix"><a href="/'+i[a].comic_id+'"><img class="comic-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="'+i[a].cover+'!cover-200" alt="'+i[a].title+'"><div class="rank-item-info"><p class="comic-name">'+i[a].title+'</p><p class="comic-author">'+i[a].author_title+'</p><p class="comic-tip">'+i[a].feature+"</p></a>",i[a].amount?n+='<p class="comic-click-count">鏈堢エ锛�'+i[a].amount+"</p></div>":i[a].read_count?n+="ascension"==c||"latest"==c||"popular"==c?'<p class="comic-click-count">鍛ㄧ偣鍑伙細'+i[a].read_count+"</p></div>":'<p class="comic-click-count">鎬荤偣鍑伙細'+i[a].read_count+"</p></div>":i[a].collection_count&&(n+='<p class="comic-click-count">鎬绘敹钘忥細'+i[a].collection_count+"</p></div>"),n+='<div class="rank-tag">'+t.index+++"</div>",t.container.append($(n))}).fail(function(){t.lock()}),t.loading(),n},t.lock=function(){t.destoryLoading(),t.moreBtn.text("娌℃湁鏇村浜唦").addClass("lock")},t.loading=function(){t.destoryLoading(),t.moreBtn.text("姝ｅ湪鍔犺浇...").addClass("lock")},t.unlock=function(){t.moreBtn.text("鐐瑰嚮鍔犺浇鏇村").removeClass("lock"),t.detectLoading()},t.detectLoading=function(){$(window).scroll(function(){var e=$(this);t.moreBtn.offset().top-e.scrollTop()<e.height()&&t.moreBtn.click()})},t.destoryLoading=function(){$(window).scroll=null},t.bindMore=function(){t.moreBtn.click(function(){$(this).hasClass("lock")||(t.pn+=1,t.renderList(t.pn))})},t},Update=function(){var t={swicher:$(".update-nav-item"),tab:$(".update-list .tab")};return t.init=function(){t.bindSwith(),t.getLimitFree(),t.getReadFirst(),t.getUserHistory(),mkz.isOpenApp()&&mkz.openApp("mkzhan://center?link=app://daily/")},t.bindSwith=function(){t.swicher.click(function(){var e=$(this),i=e.index();e.hasClass("active")||(t.tab.eq(i).show().siblings().hide(),e.find("span").addClass("active").parent().siblings().find("span").removeClass("active"),e.addClass("active").siblings().removeClass("active"))})},t.getLimitFree=function(){mkz.mkzAjax({url:"//api.mkzcdn.com/comic/recom/limit/free/v1/",type:"GET",data:{app_id:"102"}}).then(function(t){for(var e=t.data,i=0;i<e.length;i++){var n=e[i].comic_id;$(".update-item-"+n).find(".update-limit-free").css("opacity","1")}})},t.getReadFirst=function(){mkz.mkzAjax({url:"//comic.mkzcdn.com/proiority/",type:"GET"}).then(function(t){for(var e=t.data,i=0;i<e.length;i++){var n=e[i].comic_id;$(".update-item-"+n).find(".update-tag-qxk").show()}})},t.getUserHistory=function(){mkz.detectLogin()&&t.listFromServer().then(function(t){for(var e=0;e<t.length;e++){var i=t[e].object_id,n=t[e].chapter_id;$(".update-item-"+i).find(".update-read-first").attr("href","/"+i+"/"+n+".html").html("缁х画闃呰")}})},t.listFromServer=function(){var t=$.Deferred();return mkz.mkzAjax({url:"//api.mkzcdn.com/member/history/v1/",data:{uid:mkz.getUid(),sign:mkz.getSign(),type:"101"},type:"GET"}).then(function(e){var i=e.data;t.resolve(i)},function(e){t.reject(e)}),t.promise()},t},Lists=function(){var t={pn:2,ps:12,moreBtn:$(".getmore"),container:$(".catagory-list")};return t.init=function(){t.detectLoading(),t.bindMore(),t.getLimitFree()},t.renderList=function(e){t.loading();var i=$.Deferred(),n=t.ps,a=$.extend({page_num:e,page_size:n},t.getReqData());return mkz.mkzAjax({url:"//comic.mkzcdn.com/search/filter/",type:"GET",data:a}).then(function(e){var n=e.data.list,a="";0===n.length?t.lock():t.unlock();for(var c=0;c<n.length;c++)a='<li class="class-comic-item">          <a href="/'+n[c].comic_id+'/"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="'+n[c].title+'" data-src="'+n[c].cover+'!cover-200"></a>          <p class="comic-name">'+n[c].title+'</p>          <p class="comic-update">鏇存柊鑷�'+n[c].chapter_num+"璇�</p>          </li>",t.container.append($(a));i.resolve(e)}).fail(function(){t.lock(),i.reject(res)}),t.loading(),i.promise()},t.lock=function(){t.destoryLoading(),t.moreBtn.text("娌℃湁鏇村浜唦").addClass("lock")},t.loading=function(){t.destoryLoading(),t.moreBtn.text("姝ｅ湪鍔犺浇...").addClass("lock")},t.unlock=function(){t.moreBtn.text("鐐瑰嚮鍔犺浇鏇村").removeClass("lock"),t.detectLoading()},t.detectLoading=function(){$(window).scroll(function(){var e=$(this);t.moreBtn.offset().top-e.scrollTop()<e.height()&&t.moreBtn.click()})},t.destoryLoading=function(){$(window).scroll=null},t.bindMore=function(){t.moreBtn.click(function(){$(this).hasClass("lock")||(t.pn+=1,t.renderList(t.pn))})},t.getReqData=function(){var t=window.location.search.substr(1).split("&")[0],e=t.split("="),i=e[0],n=e[1],a=new Object;return a[i]=n,a},t.getLimitFree=function(){mkz.mkzAjax({url:"//api.mkzcdn.com/comic/recom/limit/free/v1/",type:"GET",data:{app_id:"102"}}).then(function(t){for(var e=t.data,i=0;i<e.length;i++){var n=e[i].comic_id;$(".class-comic-item-"+n).find(".icon-tag-xm").show()}})},t},SearchCount=function(){var t={app_id:1000103,app_secret:"462b72ef4f04679f29caba877738589e",result:[]};return t.createUnique=function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.searchCount=function(e,i){return $.ajax({url:"https://action.mkzcdn.com/keyword/add/",type:"GET",dataType:"jsonp",crossDomain:!0,data:{app_id:t.app_id,app_secret:t.app_secret,unique_id:t.createUnique(),action_type:e,comic_id:i.comic_id||"",keyword:i.keyword||"",result:i.result||"",udid:mkz.getGuid()}})},t.blurCount=function(e){var i=e.list,n=[];return $.each(i,function(t,e){n.push(e.comic_id)}),t.searchCount(1,{comic_id:e.cid,keyword:e.keyword,result:n.join()})},t.clickCount=function(e){var i=e.list,n=[];return void 0!==i&&"undefined"!==i&&i?$.each(i,function(t,e){n.push(e.comic_id)}):$(".search-result .comic-list-item").each(function(t,e){n.push($(e).data("cid"))}),t.searchCount(2,{keyword:e.keyword,result:n.join()})},t.spotlightCount=function(e){var i=[];return $(".search-result .comic-list-item").each(function(t,e){i.push($(e).data("cid"))}),t.searchCount(3,{comic_id:e.comic_id,keyword:e.keyword,result:i.join()})},t},Search=function(){function t(t,e){var i=null;return function(){var n=this,a=arguments;clearTimeout(i),i=setTimeout(function(){t.apply(n,a)},e)}}var e={input:$("#searchInput"),historyBox:$(".search-history"),hot:$(".hot-search"),active:$(".search-active"),historyList:$(".search-history-list"),clearBtn:$(".search-history-clear"),searchList:[]},i=SearchCount();return e.init=function(){var t=$.Deferred();e.initInput(),e.bindSearch(),e.renderList(t).done(function(){e.bindSigleDel()}),e.bindDelAll()},e.keywordSearch=function(t){return $(".search-active").off("click"),mkz.mkzAjax({url:"//comic.mkzcdn.com/search/keyword/",type:"GET",data:{keyword:t,page_num:1,page_size:50}})},e.rendActiveCon=function(t,i){var n=new RegExp(i,"ig"),a=t.length,c="";if(a>0){e.hot.hide();for(var o=0;o<a;o++)c+='<div class="search-active-item" data-keyword="'+i+'" data-cid="'+t[o].comic_id+'"><p class="comic-name">'+t[o].title.replace(n,function(t){return'<span style="color:#ff7830;">'+t+"</span>"})+'</p><p class="comic-author">浣滆€咃細'+t[o].author_title.replace(n,function(t){return'<span style="color:red">'+t+"</span>"})+"</p></div>";0!=$(".search-result").length&&$(".search-result").hide(),e.active.html(c)}},e.initInput=function(){e.input.focus(function(){e.historyBox.hide()}).blur(function(){$.trim($(this).val())||(e.hot.show(),e.historyBox.show(),e.active.hide())}),e.input.on("input",t(function(){e.active.empty();var t=$.trim($(this).val());if(!t)return 0!=$(".search-result").length&&$(".search-result").show(),!1;e.keywordSearch(t).then(function(n){e.searchList=n.data.list,e.rendActiveCon(e.searchList,t),$(".search-active").on("click",".search-active-item",function(){var t=$(this).data();t.list=e.searchList,i.blurCount(t),window.location.href="/"+t.cid+"/"})})},200))},e.bindSearch=function(){var t=function(){var t=e.input.val();t||(t=e.input.data("holder")),e.save(t),i.clickCount({keyword:t,list:e.searchList}),location.href="/spotlight?keyword="+t};$(".search-btn").click(function(){t()}),e.input[0].onsearch=function(){t()}},e.renderList=function(t){for(var i=e.getHistory(),n="",a=0;a<i.length;a++)n='<p class="search-history-item clearfix"><a href="/spotlight?keyword='+i[a]+'"><span class="search-his-txt">'+i[a]+'</span></a><span class="del-btn"><i class="ift-searchlist_clearo"></i></span></p>',e.historyList.append($(n));return t.resolve(),t.promise()},e.bindSigleDel=function(){$(".del-btn").click(function(){for(var t=$(this),i=e.getHistory(),n=t.prev().find(".search-his-txt").text(),a=0;a<i.length;a++)if(i[a]===n){i.splice(a,1);break}t.parents(".search-history-item").remove(),$.cookie("search_history",JSON.stringify(i),{path:"/"}),e.historyVisible()})},e.bindDelAll=function(){0===e.getHistory().length&&$(".search-history").hide(),e.clearBtn.click(function(){layer.open({content:"浜诧紝纭畾瑕佸垹闄ゅ巻鍙插悧锛�",btn:["纭畾","鍙栨秷"],yes:function(t){e.clear(),layer.close(t)}})})},e.historyVisible=function(){0===e.getHistory().length?$(".search-history").hide():$(".search-history").show()},e.getHistory=function(){var t=$.cookie("search_history");return t?JSON.parse(t):[]},e.save=function(t){var e=$.cookie("search_history"),i=[],n=$.trim(t);if(e){i=JSON.parse(e);for(var a=i.length,c=0;c<a;c++)if(i[c]===n){i.splice(c,1);break}}""!=n&&i.unshift(n),i.length>10&&i.splice(0,1),$.cookie("search_history",JSON.stringify(i),{path:"/"})},e.clear=function(){$.cookie("search_history","[]",{path:"/"}),e.historyList.empty(),$(".search-history").hide()},e},Spotlight=function(){var t={input:$("#searchInput"),pn:1,ps:20,moreBtn:$(".getmore"),container:$(".search-result")};t.init=function(){t.detectLoading(),t.bindMore(),t.bindSearch(),t.bindItemClick(),t.initSearchInput()},t.initSearchInput=function(){var e=window.location.search,i=e.split("keyword=")[1],n=decodeURI(i);t.save(n),$(".search-input").val(n)};var e=SearchCount();return t.bindItemClick=function(){var i=t.getReqData();$(".search-result").on("click",".comic-list-item",function(){e.spotlightCount({comic_id:$(this).data("cid")||"",keyword:i.keyword})}),$(".comic-item-info").click(function(){var t=$(this).data("cid");e.spotlightCount({comic_id:$(this).data("cid")||"",keyword:i.keyword}),window.location.href="/"+t+"/"})},t.bindSearch=function(){$(".search-btn").click(function(){var i=t.input.val();i||(i=t.input.data("holder")),t.save(i),e.clickCount({keyword:i}),location.href="/spotlight/?keyword="+i})},t.save=function(t){var e=$.cookie("search_history"),i=[],n=$.trim(t);if(e){i=JSON.parse(e);for(var a=i.length,c=0;c<a;c++)if(i[c]===n){i.splice(c,1);break}}""!=n&&i.push(n),i.length>10&&i.splice(0,1),$.cookie("search_history",JSON.stringify(i),{path:"/"})},t.renderList=function(e){t.loading();var i=t.ps,n=$.Deferred(),a=$.extend({page_num:e,page_size:i},t.getReqData());return mkz.mkzAjax({url:"//comic.mkzcdn.com/search/keyword/",type:"GET",data:a}).then(function(e){var i=e.data.list;0===i.length?t.lock():t.unlock();for(var a=0;a<i.length;a++){var c=$('<div class="comic-list-item clearfix" data-cid="'+i[a].comic_id+'"><a class="cover" href="/94316/"><img src="'+i[a].cover+'!cover-400" alt="鏂楃牬鑻嶇┕灏忚杩炶浇婕敾"></a><div class="comic-item-info" data-cid="'+i[a].comic_id+'"><p class="comic-name">'+i[a].title+'</p><p class="comic-author">'+i[a].author_title+'</p><p class="comic-tags">'+i[a].theme+'</p><p class="comic-update-at">鏇存柊鑷�'+i[a].chapter_num+'璇�</p></div><a class="fast-read-btn" href="/'+i[a].comic_id+"/"+i[a].chpater_id+'"><i class="ift-searchlist_read1"></i><span>閫熺湅</span></a></div>');t.container.append(c)}n.resolve(e)}).fail(function(e){t.lock(),n.reject(e)}),t.loading(),n},t.lock=function(){t.destoryLoading(),t.moreBtn.text("娌℃湁鏇村浜唦").addClass("lock")},t.loading=function(){t.destoryLoading(),t.moreBtn.text("姝ｅ湪鍔犺浇...").addClass("lock")},t.unlock=function(){t.moreBtn.text("鐐瑰嚮鍔犺浇鏇村").removeClass("lock"),t.detectLoading()},t.detectLoading=function(){$(window).scroll(function(){var e=$(this);t.moreBtn.offset().top-e.scrollTop()<e.height()&&t.moreBtn.click()})},t.destoryLoading=function(){$(window).scroll=null},t.bindMore=function(){t.moreBtn.click(function(){$(this).hasClass("lock")||(t.pn+=1,t.renderList(t.pn))})},t.getReqData=function(){var t=window.location.search.substr(1).split("&")[0],e=t.split("="),i=e[0],n=decodeURI(e[1]),a=new Object;return a[i]=n,a},t},__main=function(){mkz.lazyLoad(),function(){var t=window.location.href;return/category\/\?/.test(t)?Lists():/top/.test(t)?Top():/update/.test(t)?Update():/category\//.test(t)?Catagory():/search/.test(t)?Search():/spotlight/.test(t)?Spotlight():Index()}().init(),Tourist().init()};__main();